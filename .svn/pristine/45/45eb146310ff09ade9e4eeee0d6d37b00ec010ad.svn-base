<form [formGroup]="theFormGroup">
    <div class="container" style="min-height: 750px;">

        <p-toast position="bottom-center" key="d"></p-toast>


        <fieldset class="border p-2" style="width: 100%;">
            <legend class="w-auto">Consulta de incidencias de tiempo</legend>
            <div class="row">
                <div class="col-md-12">
                    <hr />
                    <label style="font-size: small; font-style: oblique;">*Para mostrar resultados, es importante que
                        realice la búsqueda a través de fechas</label>
                    <h6>Filtros de búsqueda *:</h6>
                    <div class="row">

                        <div class="col-md-2">
                            <p-calendar [readonlyInput]="true" [locale]="es" [monthNavigator]="true"
                                [yearNavigator]="true" [yearRange]="rangoAnios" [style]="{'width':'100%'}"
                                placeholder="Fecha inicio *" [maxDate]="maxDate" [(ngModel)]="fechaInicio"
                                formControlName="startDate" ValidatorCalendar></p-calendar>
                                <div *ngIf="!theFormGroup.valid">
                                    <p-message severity="error" text="Fecha inicio es menor a fecha fin"
                                        *ngIf="theFormGroup.get('startDate').hasError('startDateIsLess')">
                                    </p-message>
                                    <p-message severity="error" text="Fecha inicio es requerido"
                                        *ngIf="theFormGroup.get('startDate').hasError('startDateIsRequired')">
                                    </p-message>
                                </div>
                        </div>


                        <div class="col-md-2">
                            <p-calendar [readonlyInput]="true" [locale]="es" [monthNavigator]="true"
                                [yearNavigator]="true" [yearRange]="rangoAnios" [style]="{'width':'100%'}"
                                placeholder="Fecha fin *" [maxDate]="maxDate" [(ngModel)]="fechaFin"
                                formControlName="endDate" ValidatorCalendar></p-calendar>
                                <div *ngIf="!theFormGroup.valid">
                                    <p-message severity="error" text="Fecha inicio es menor a fecha fin"
                                        *ngIf="theFormGroup.get('endDate').hasError('startDateIsLess')">
                                    </p-message>
                                    <p-message severity="error" text="Fecha fin es requerido"
                                        *ngIf="theFormGroup.get('endDate').hasError('endDateIsRequired')">
                                    </p-message>
                                </div>
                        </div>
                        <div class="col-md-2">

                            <button pButton type="button" label="Buscar" [style]="{'width':'100%'}"
                                (click)="consultaincidenciasTiempo()" [disabled]="theFormGroup.invalid"></button>
                        </div>

                    </div>
                    <hr />
                </div>
                <p-table #dt [value]="incidenciasTiempo" [columns]="cols" [rows]="10" [rowsPerPageOptions]="[10,25,50]"
                    [paginator]="true">

                    <ng-template pTemplate="header" let-columns>
                        <tr>
                            <th *ngFor="let col of columns" [pSortableColumn]="col.field">
                                {{col.header}}

                            </th>
                        </tr>

                        <tr>
                            <th *ngFor="let col of columns" [ngSwitch]="col.field">
                                <input *ngSwitchCase="'CLAVEINCIDENCIA'" pInputText type="text"
                                    [style]="{'width':'100%','margin-top':'8px'}"
                                    (input)="dt.filter($event.target.value, col.field, 'contains')">
                                <input *ngSwitchCase="'NOMBREINCIDENCIA'" pInputText type="text"
                                    [style]="{'width':'100%','margin-top':'8px'}"
                                    (input)="dt.filter($event.target.value, col.field, 'contains')">
                                <input *ngSwitchCase="'NUMEROINCIDENCIA'" pInputText type="text"
                                    [style]="{'width':'100%','margin-top':'8px'}"
                                    (input)="dt.filter($event.target.value, col.field, 'contains')">
                                <input *ngSwitchCase="'FECHAINICIO'" pInputText type="text"
                                    [style]="{'width':'100%','margin-top':'8px'}"
                                    (input)="dt.filter($event.target.value, col.field, 'contains')">
                                <input *ngSwitchCase="'FECHAFIN'" pInputText type="text"
                                    [style]="{'width':'100%','margin-top':'8px'}"
                                    (input)="dt.filter($event.target.value, col.field, 'contains')">


                                <input *ngSwitchCase="'NUMEROUNIDADES'" pInputText type="text"
                                    [style]="{'width':'100%','margin-top':'8px'}"
                                    (input)="dt.filter($event.target.value, col.field, 'contains')">
                                <input *ngSwitchCase="'NOMBREPLAZA'" pInputText type="text"
                                    [style]="{'width':'100%','margin-top':'8px'}"
                                    (input)="dt.filter($event.target.value, col.field, 'contains')">
                                <input *ngSwitchCase="'NUMEROPLAZA'" pInputText type="text"
                                    [style]="{'width':'100%','margin-top':'8px'}"
                                    (input)="dt.filter($event.target.value, col.field, 'contains')">

                            </th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-rowData>
                        <tr [pSelectableRow]="rowData">
                            <td>{{rowData.CLAVEINCIDENCIA}}</td>
                            <td>{{rowData.NOMBREINCIDENCIA}}</td>
                            <td>{{rowData.NUMEROINCIDENCIA}}</td>
                            <td>{{rowData.FECHAINICIO| dateFormat}}</td>
                            <td>{{rowData.FECHAFIN| dateFormat}}</td>
                            <td>{{rowData.NUMEROUNIDADES}}</td>

                            <td>{{rowData.NOMBREPLAZA}}</td>
                            <td>{{rowData.NUMEROPLAZA}}</td>


                        </tr>
                    </ng-template>

                    <ng-template pTemplate="emptymessage" let-columns>
                        <tr>
                            <td [attr.colspan]="columns.length">
                                <strong> No se encontraron registros </strong>
                            </td>
                        </tr>
                    </ng-template>

                </p-table>


            </div>
        </fieldset>
    </div>
</form>
<ngx-spinner></ngx-spinner>